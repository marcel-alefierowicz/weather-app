---
import Layout from "../layouts/Layout.astro";
import codes from "../codes";
import moment from 'moment';
import Sun from 'astro-heroicons/mini/Sun.astro'
import Cloud from 'astro-heroicons/mini/Cloud.astro'



// const lat = '51.5072'; // London
// const lon = '0.1276';  //

const lat = "53.1325";
const lon = "23.1688";

const weather = await fetch(
  `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min,weathercode&current_weather=true&timezone=auto`
); // Bialystok
const location = await fetch(
  `https://api.geoapify.com/v1/geocode/reverse?lat=${lat}&lon=${lon}&apiKey=578e174b86d84134a1eb2c82258823f9`
);

const weatherdata = await weather.json();
const locationdata = await location.json();

console.log(weatherdata)

const weathercode = String(weatherdata.current_weather.weathercode);
const temperature = weatherdata.current_weather.temperature;
const min = weatherdata.daily.temperature_2m_min[0];
const max = weatherdata.daily.temperature_2m_max[0];
---

<Layout title="Weather">
  <div
    class="flex flex-col w-2/5 h-2/3 bg-[url('/img/night-clouds.gif')] bg-cover items-center rounded-2xl"
  >
    <div class="flex flex-col justify-center items-center h-1/3 rounded-2xl">
      <h1 class="text-white font-semibold text-2xl drop-shadow-xl">
        {locationdata.features[0].properties.city}
      </h1>
      <p class="text-white text-6xl drop-shadow-xl font-semibold">
        {temperature}°
      </p>
      <p class="text-white text-lg drop-shadow-xl font-semibold">
        {codes[weathercode]}
      </p>
      <p class="text-white text-md drop-shadow-xl font-semibold">
        H:{max}° L:{min}°
      </p>
    </div>
    <div class="flex flex-col justify-between backdrop-blur-md w-4/5 h-1/3 p-4 rounded-xl">
      {weatherdata.daily.time.map((time, key) => (
        <div class="flex flex-row h-1/10 items-center gap-5">
          <p class="text-white font-normal">
            {moment(time).format('ddd Do')}, {weatherdata.daily.temperature_2m_max[key]}
          </p>

        {weatherdata.daily.weathercode[key] == 0 ? (<Sun class="w-5 h-5 text-white"/>) : (<Cloud class="w-5 h-5 text-white"/>) }  

        </div>
      ))}
    </div>
  </div>
</Layout>
